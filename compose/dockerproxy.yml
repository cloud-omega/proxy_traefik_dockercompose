services:
    dockerproxy:
      image: ghcr.io/tecnativa/docker-socket-proxy/usr/local/etc/haproxy/haproxy.cfg:
      container_name: dockerproxy
      read_only: true 
      cap_drop: 
        - ALL
      environment:
        - CONTAINERS=1
        - NETWORKS=1
        - EVENTS=1 
        # Deny all other access
        - SERVICES=0
        - TASKS=0
        - VOLUMES=0
        - SECRETS=0
        - SWARM=0
        - NODES=0
        - POST=0 # read-only
      #ports:        - 127.0.0.1:2375:2375
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock:ro
        - /tmp/haproxy:/usr/local/etc/haproxy/
      restart: unless-stopped
      networks: 
        - sec
      deploy:
        resources:
          limits:
            cpus: '0.50'
            memory: 128M
          reservations:
            cpus: '0.25'
            memory: 64M
      labels:
        - homepage.group=Infra
        - homepage.name=Docker Proxy
        - homepage.icon=docker
        - homepage.href=http://dockerproxy.local:2375
        - homepage.description=Proxy seguro do Docker
